# wasm_bazel

A simple set of bazel rules and macros to build web assembly files with the Emscripten compiler.

Caveats (and TODOs):

 - Only works on linux
 - Only tested on relatively simple examples

# Difference from CROSSTOOLS

How is this different from using [Emscripten with CROSSTOOLs](https://docs.bazel.build/versions/0.22.0/tutorial/crosstool.html)?

CROSSTOOLs allows you to build your entire c++ project for either the host system (`--host_crosstool_top=@bazel_tools//tools/cpp:toolchain`) or the wasm system (`--crosstool_top=//toolchain:emscripten`). This is great if you're exclusively targeting one system or the other.

This project allows you to have wasm build rules that co-exist with your host system build rules. For example, if you're building a webserver in C++ that should serve compiled wasm code, you can have a set of target that define the wasm binary (built using Emscripten) and another set of targets for the C++ webserver (built using your host compiler).

Neither is strictly better, they just serve different purposes. My recommendation: Use CROSSTOOLs if your entire project is built for the host or wasm (but never both); otherwise consider this set of tools.

# Usage

_file: WORKSPACE_
```
load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

http_archive(
    name = "wasm_bazel",
    urls = [{ LATEST RELEASE URL FOR THIS REPO }],
    strip_prefix = "wasm_bazel-{RELEASE VERSION NUMBER}",
)
load("@wasm_bazel//:deps.bzl", "wasm_bazel_dev_dependencies")
wasm_bazel_dev_dependencies()
```

_file: BUILD_
```
load("@wasm_bazel//:wasm.bzl", "cc_native_wasm_library", "cc_native_wasm_binary")

# Defines both a cc_library for the host system and a wasm_library for web assembly.
cc_native_wasm_library(
  name = "library",
  ...
)

# Defines both a cc_binary for the host system and a wasm_binary for web assembly.
#
# wasm_biniary will output two files that are generated by Emscripten:
#  - binary-wasm.js
#  - binary-wasm.wasm
# 
# See Emscripten for more details.
cc_native_wasm_library(
  name = "binary",
  deps = [
      ":library",
  ],
  ...
)
```

See a working example in the examples directory.

# License

Licensed under MIT (see LICENSE).
